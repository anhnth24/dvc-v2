# [tthc] Schema - Administrative Procedures Catalog

## OVERVIEW

The `[tthc]` schema manages the comprehensive catalog of Vietnamese administrative procedures (Thủ tục Hành chính). It handles procedure definitions, implementation organizations, processing requirements, fee structures, and execution workflows for government services.

## SCHEMA CREATION

```sql
-- Administrative Procedures Catalog
CREATE SCHEMA [tthc];
GO
```

## CORE PROCEDURE MANAGEMENT TABLES

### 1. DM_QG_THUTUCHANHCHINH - Master administrative procedures

```sql
CREATE TABLE [tthc].DM_QG_THUTUCHANHCHINH (
    TTHCID BIGINT PRIMARY KEY IDENTITY,
    MaTTHC NVARCHAR(50) UNIQUE NOT NULL,
    TenTTHC NVARCHAR(500) NOT NULL,
    TenTiengAnh NVARCHAR(500),

    -- Procedure classification
    LinhVucID INT NOT NULL,
    CapThucHienID INT NOT NULL,
    MucDo TINYINT DEFAULT 3, -- 1=High, 2=Medium, 3=Normal, 4=Low priority

    -- Legal framework
    VanBanQuyDinh NVARCHAR(2000), -- JSON array of legal documents
    CoqueBanHanh NVARCHAR(500),
    NgayBanHanh DATE,
    NgayHieuLuc DATE,
    NgayHetHieuLuc DATE,

    -- Processing details
    CachThucThucHienID INT,
    DoiTuongThucHienID INT,
    ThoiHanGiaiQuyetNgay INT NOT NULL,
    ThoiHanGiaiQuyetGio INT DEFAULT 0,
    DonViThoiGian NVARCHAR(20) DEFAULT 'ngay', -- ngay/gio/phut

    -- Service delivery
    TrinhTuThucHien NVARCHAR(MAX), -- Detailed procedure steps
    CachThucNopHoSo NVARCHAR(MAX), -- JSON array of submission methods
    CachThucTraKetQua NVARCHAR(MAX), -- JSON array of delivery methods

    -- Fee structure
    LoaiPhiLePhi TINYINT DEFAULT 0, -- 0=Free, 1=Fixed, 2=Variable, 3=Calculated
    PhiCoSo DECIMAL(18,2) DEFAULT 0,
    PhiToiDa DECIMAL(18,2),
    DonViTinhPhi NVARCHAR(50),
    CongThucTinhPhi NVARCHAR(1000), -- Formula for complex calculations

    -- Digital transformation
    MucDoDienTuHoa TINYINT DEFAULT 1, -- 1=Paper, 2=Partial, 3=Full, 4=Advanced
    HoTroDienTu BIT DEFAULT 0,
    HoTroTraCuuOnline BIT DEFAULT 0,
    HoTroThanhToanOnline BIT DEFAULT 0,
    HoTroTichHopDLQG BIT DEFAULT 0, -- National database integration

    -- Quality metrics
    TyLeDungHan DECIMAL(5,2) DEFAULT 95.0, -- Target on-time completion rate
    TyLePhatSinh DECIMAL(5,2) DEFAULT 5.0, -- Expected additional document rate
    MucDoHaiLong DECIMAL(3,1) DEFAULT 4.0, -- Target satisfaction rating
    SoLuongXuLyTrungBinh INT DEFAULT 100, -- Average monthly processing volume

    -- Integration and automation
    CoTheXuLyTuDong BIT DEFAULT 0,
    YeuCauChuKySo BIT DEFAULT 0,
    YeuCauXacThucDinhDanh BIT DEFAULT 0,
    TichHopAPILienThong BIT DEFAULT 0,
    MaAPIThaoTac NVARCHAR(100), -- API operation code for system integration

    -- Business rules
    QuyTacKiemTraHoSo NVARCHAR(MAX), -- JSON validation rules
    QuyTacPhanCong NVARCHAR(MAX), -- JSON assignment rules
    QuyTacGiamSat NVARCHAR(MAX), -- JSON monitoring rules
    DKTienQuyetDDB NVARCHAR(MAX), -- Prerequisites (JSON)

    -- Status and lifecycle
    TrangThaiSuDung TINYINT DEFAULT 1, -- 1=Active, 2=Suspended, 3=Deprecated
    LyDoTamDung NVARCHAR(1000),
    NgayTamDung DATE,
    NgayKhoiPhucLai DATE,

    -- Audit trail
    IsActive BIT DEFAULT 1,
    NgayTao DATETIME2 DEFAULT GETDATE(),
    NguoiTao BIGINT,
    NgayCapNhat DATETIME2,
    NguoiCapNhat BIGINT,
    NgayXoa DATETIME2,
    NguoiXoa BIGINT,

    -- Constraints
    CONSTRAINT FK_TTHC_LinhVuc FOREIGN KEY (LinhVucID) REFERENCES [lookup].DM_QG_LINHVUC(LinhVucID),
    CONSTRAINT FK_TTHC_CapThucHien FOREIGN KEY (CapThucHienID) REFERENCES [lookup].DM_CAPTHUCHIEN(CapThucHienID),
    CONSTRAINT FK_TTHC_CachThucThucHien FOREIGN KEY (CachThucThucHienID) REFERENCES [lookup].DM_CACHTHUCTHUCHIEN(CachThucThucHienID),
    CONSTRAINT FK_TTHC_DoiTuongThucHien FOREIGN KEY (DoiTuongThucHienID) REFERENCES [lookup].DM_DOITUONGTHUCHIEN(DoiTuongThucHienID),
    CONSTRAINT CK_TTHC_ThoiHan CHECK (ThoiHanGiaiQuyetNgay > 0),
    CONSTRAINT CK_TTHC_PhiCoSo CHECK (PhiCoSo >= 0),
    CONSTRAINT CK_TTHC_MucDo CHECK (MucDo BETWEEN 1 AND 4)
);
GO

-- Indexes
CREATE INDEX IX_TTHC_Ma ON [tthc].DM_QG_THUTUCHANHCHINH(MaTTHC);
CREATE INDEX IX_TTHC_LinhVuc ON [tthc].DM_QG_THUTUCHANHCHINH(LinhVucID, TrangThaiSuDung);
CREATE INDEX IX_TTHC_CapThucHien ON [tthc].DM_QG_THUTUCHANHCHINH(CapThucHienID, IsActive);
CREATE INDEX IX_TTHC_TrangThai ON [tthc].DM_QG_THUTUCHANHCHINH(TrangThaiSuDung, IsActive);
CREATE INDEX IX_TTHC_MucDoDienTu ON [tthc].DM_QG_THUTUCHANHCHINH(MucDoDienTuHoa, HoTroDienTu);
CREATE INDEX IX_TTHC_HieuLuc ON [tthc].DM_QG_THUTUCHANHCHINH(NgayHieuLuc, NgayHetHieuLuc);
CREATE INDEX IX_TTHC_ThoiHan ON [tthc].DM_QG_THUTUCHANHCHINH(ThoiHanGiaiQuyetNgay, CapThucHienID);
CREATE INDEX IX_TTHC_Updated ON [tthc].DM_QG_THUTUCHANHCHINH(NgayCapNhat DESC);
GO
```

### 2. DM_QG_TTHC_COQUANTHUCHIEN - Implementation organizations

```sql
CREATE TABLE [tthc].DM_QG_TTHC_COQUANTHUCHIEN (
    ID BIGINT PRIMARY KEY IDENTITY,
    TTHCID BIGINT NOT NULL,
    DonViID BIGINT NOT NULL, -- Organization implementing this procedure

    -- Implementation scope
    VaiTro NVARCHAR(100) NOT NULL, -- Primary/Secondary/Support/Review
    CapDo TINYINT NOT NULL, -- 1=Central, 2=Provincial, 3=District, 4=Commune
    LaPhanCongChinh BIT DEFAULT 0, -- Is primary implementer?

    -- Capacity and performance
    NangLucXuLy INT DEFAULT 10, -- Processing capacity per day
    ThoiGianXuLyTrungBinh INT, -- Average processing time in hours
    TyLeHoanThanh DECIMAL(5,2) DEFAULT 95.0, -- Completion rate percentage

    -- Service delivery configuration
    HoTroNopTrucTuyen BIT DEFAULT 0,
    HoTroNopTrucTiep BIT DEFAULT 1,
    HoTroNopQuaBuuDien BIT DEFAULT 0,
    HoTroTraKetQuaTrucTuyen BIT DEFAULT 0,
    HoTroTraKetQuaTrucTiep BIT DEFAULT 1,

    -- Working hours and availability
    ThoiGianLamViec NVARCHAR(500), -- JSON schedule
    NgayLamViec NVARCHAR(200), -- JSON working days
    SupportAfterHours BIT DEFAULT 0,

    -- Contact and location
    DiaChi NVARCHAR(500),
    SoDienThoai NVARCHAR(50),
    Email NVARCHAR(255),
    Website NVARCHAR(255),

    -- Quality metrics
    MucDoHaiLongKhachHang DECIMAL(3,1), -- Customer satisfaction
    SoKhieuNaiThang INT DEFAULT 0, -- Monthly complaints
    TyLeGiaiQuyetDungHan DECIMAL(5,2), -- On-time resolution rate

    -- Status and lifecycle
    NgayBatDauThucHien DATE NOT NULL,
    NgayKetThucThucHien DATE,
    TrangThai TINYINT DEFAULT 1, -- 1=Active, 2=Suspended, 3=Inactive
    LyDoTamDung NVARCHAR(1000),

    -- Audit trail
    NgayTao DATETIME2 DEFAULT GETDATE(),
    NguoiTao BIGINT NOT NULL,
    NgayCapNhat DATETIME2,
    NguoiCapNhat BIGINT,

    -- Constraints
    CONSTRAINT FK_TTHC_COQUAN_TTHC FOREIGN KEY (TTHCID) REFERENCES [tthc].DM_QG_THUTUCHANHCHINH(TTHCID),
    CONSTRAINT UC_TTHC_COQUAN UNIQUE (TTHCID, DonViID, VaiTro)
);
GO

-- Indexes
CREATE INDEX IX_TTHC_COQUAN_TTHC ON [tthc].DM_QG_TTHC_COQUANTHUCHIEN(TTHCID, TrangThai);
CREATE INDEX IX_TTHC_COQUAN_DONVI ON [tthc].DM_QG_TTHC_COQUANTHUCHIEN(DonViID, TrangThai);
CREATE INDEX IX_TTHC_COQUAN_VAI_TRO ON [tthc].DM_QG_TTHC_COQUANTHUCHIEN(VaiTro, CapDo);
CREATE INDEX IX_TTHC_COQUAN_CHINH ON [tthc].DM_QG_TTHC_COQUANTHUCHIEN(LaPhanCongChinh, TrangThai);
GO
```

### 3. DM_QG_TTHC_KETQUA - Expected procedure results

```sql
CREATE TABLE [tthc].DM_QG_TTHC_KETQUA (
    ID BIGINT PRIMARY KEY IDENTITY,
    TTHCID BIGINT NOT NULL,

    -- Result definition
    TenKetQua NVARCHAR(500) NOT NULL,
    MoTaKetQua NVARCHAR(2000),
    LoaiKetQua NVARCHAR(100) NOT NULL, -- Certificate/License/Approval/Rejection/Decision

    -- Document specifications
    MauKetQua NVARCHAR(500), -- Template file path or name
    DinhDangFile NVARCHAR(100), -- PDF/DOC/XML/JSON
    KichThuocGiayKetQua NVARCHAR(50), -- A4/A3/Custom

    -- Digital signature requirements
    YeuCauChuKySo BIT DEFAULT 0,
    LoaiChuKySo NVARCHAR(100), -- Personal/Organization/Advanced
    ThuTuKy TINYINT DEFAULT 1, -- Signing order

    -- Delivery options
    CachThucNhanKetQua NVARCHAR(MAX), -- JSON array of delivery methods
    PhiVanChuyen DECIMAL(10,2) DEFAULT 0,
    ThoiGianVanChuyen INT DEFAULT 3, -- Days for delivery

    -- Validity and lifecycle
    ThoiHanHieuLuc INT, -- Validity period in days
    CoTheDongDau BIT DEFAULT 1,
    CoTheInAn BIT DEFAULT 1,
    SoLuongBanSao INT DEFAULT 1,

    -- Integration
    MaKetQuaTichHop NVARCHAR(100), -- Code for system integration
    APIThongBao NVARCHAR(200), -- API endpoint for notifications
    DongBoDBQuocGia BIT DEFAULT 0, -- Sync with national database

    -- Usage statistics
    SoLuongCapHangThang INT DEFAULT 0,
    TyLeYeuCauSua DECIMAL(5,2) DEFAULT 0,
    ThoiGianXuLyTrungBinh INT, -- Average processing time in minutes

    -- Status
    TrangThai TINYINT DEFAULT 1, -- 1=Active, 2=Suspended, 3=Deprecated
    ThuTu INT DEFAULT 1, -- Display order

    -- Audit trail
    NgayTao DATETIME2 DEFAULT GETDATE(),
    NguoiTao BIGINT NOT NULL,
    NgayCapNhat DATETIME2,
    NguoiCapNhat BIGINT,

    CONSTRAINT FK_TTHC_KETQUA_TTHC FOREIGN KEY (TTHCID) REFERENCES [tthc].DM_QG_THUTUCHANHCHINH(TTHCID)
);
GO

-- Indexes
CREATE INDEX IX_TTHC_KETQUA_TTHC ON [tthc].DM_QG_TTHC_KETQUA(TTHCID, TrangThai);
CREATE INDEX IX_TTHC_KETQUA_LOAI ON [tthc].DM_QG_TTHC_KETQUA(LoaiKetQua, TrangThai);
CREATE INDEX IX_TTHC_KETQUA_THU_TU ON [tthc].DM_QG_TTHC_KETQUA(ThuTu, TrangThai);
GO
```

### 4. DM_QG_TTHC_CANCUPHAPLY - Required supporting documents

```sql
CREATE TABLE [tthc].DM_QG_TTHC_CANCUPHAPLY (
    ID BIGINT PRIMARY KEY IDENTITY,
    TTHCID BIGINT NOT NULL,

    -- Document definition
    TenGiayTo NVARCHAR(500) NOT NULL,
    MoTaChiTiet NVARCHAR(2000),
    LoaiGiayTo NVARCHAR(100), -- Identity/Certificate/Report/Application/Other

    -- Requirements
    LaBatBuoc BIT DEFAULT 1,
    SoLuongYeuCau INT DEFAULT 1,
    SoLuongToiDa INT DEFAULT 1,

    -- Document specifications
    DinhDangChapNhan NVARCHAR(200), -- JSON array: PDF/JPG/PNG/DOC
    KichThuocToiDa INT DEFAULT 5, -- MB
    ChupAnhChapNhan BIT DEFAULT 1,
    BanSaoChapNhan BIT DEFAULT 1,
    YeuCauBanGoc BIT DEFAULT 0,
    YeuCauCongChung BIT DEFAULT 0,
    YeuCauChungThuc BIT DEFAULT 0,

    -- Validation rules
    QuyTacKiemTra NVARCHAR(MAX), -- JSON validation rules
    BieuMauCoDinh NVARCHAR(500), -- Template file if standardized
    NgonNguChapNhan NVARCHAR(100), -- vi/en/other

    -- Time constraints
    ThoiHanHieuLuc INT, -- Document validity in days
    NgayHetHanToiThieu DATE, -- Minimum expiry date
    ThoiGianCapToiDa INT, -- Maximum age in days

    -- Digital processing
    HoTroNhanDangOCR BIT DEFAULT 0,
    TruongThongTinTuDong NVARCHAR(MAX), -- JSON: auto-extractable fields
    TichHopCSDLQuocGia BIT DEFAULT 0,
    MaAPILienThong NVARCHAR(100),

    -- Alternative documents
    GiayToThayThe NVARCHAR(MAX), -- JSON array of alternative documents
    DieuKienMienGiayTo NVARCHAR(1000), -- Conditions for exemption
    GhiChuDacBiet NVARCHAR(1000),

    -- Processing metrics
    TyLeThieuGiayTo DECIMAL(5,2) DEFAULT 0, -- Missing document rate
    ThoiGianKiemTraTrungBinh INT DEFAULT 5, -- Average verification time (minutes)
    TyLeLoi DECIMAL(5,2) DEFAULT 0, -- Error rate

    -- Display and grouping
    NhomGiayTo NVARCHAR(100), -- Document group
    ThuTuHienThi INT DEFAULT 1,
    BieuTuongHienThi NVARCHAR(100), -- Icon for display
    MauSacNhom NVARCHAR(20), -- Color code

    -- Status
    TrangThai TINYINT DEFAULT 1,

    -- Audit trail
    NgayTao DATETIME2 DEFAULT GETDATE(),
    NguoiTao BIGINT NOT NULL,
    NgayCapNhat DATETIME2,
    NguoiCapNhat BIGINT,

    CONSTRAINT FK_TTHC_CANCU_TTHC FOREIGN KEY (TTHCID) REFERENCES [tthc].DM_QG_THUTUCHANHCHINH(TTHCID)
);
GO

-- Indexes
CREATE INDEX IX_TTHC_CANCU_TTHC ON [tthc].DM_QG_TTHC_CANCUPHAPLY(TTHCID, TrangThai);
CREATE INDEX IX_TTHC_CANCU_LOAI ON [tthc].DM_QG_TTHC_CANCUPHAPLY(LoaiGiayTo, LaBatBuoc);
CREATE INDEX IX_TTHC_CANCU_NHOM ON [tthc].DM_QG_TTHC_CANCUPHAPLY(NhomGiayTo, ThuTuHienThi);
CREATE INDEX IX_TTHC_CANCU_BATBUOC ON [tthc].DM_QG_TTHC_CANCUPHAPLY(LaBatBuoc, TrangThai);
GO
```

### 5. DM_QG_TTHC_THOIGIAN_PHILEPHI - Fee schedule and timing

```sql
CREATE TABLE [tthc].DM_QG_TTHC_THOIGIAN_PHILEPHI (
    ID BIGINT PRIMARY KEY IDENTITY,
    TTHCID BIGINT NOT NULL,

    -- Fee definition
    TenKhoanPhi NVARCHAR(300) NOT NULL,
    MoTaPhi NVARCHAR(1000),
    LoaiPhi TINYINT NOT NULL, -- 1=Administrative, 2=Service, 3=Expedite, 4=Penalty

    -- Fee calculation
    GiaTriPhi DECIMAL(18,2) NOT NULL,
    DonViTinh NVARCHAR(50) DEFAULT 'VND',
    PhuongThucTinhPhi NVARCHAR(100), -- Fixed/Percentage/Formula/Tier
    CongThucTinh NVARCHAR(1000), -- Mathematical formula

    -- Fee conditions
    DieuKienApDung NVARCHAR(2000), -- JSON conditions
    GiaTriToiThieu DECIMAL(18,2),
    GiaTriToiDa DECIMAL(18,2),

    -- Time-based pricing
    BacGia TINYINT DEFAULT 1, -- Price tier
    ThoiGianApDung NVARCHAR(500), -- Time periods when fee applies
    ThoiGianGiamGia NVARCHAR(500), -- Discount periods
    TyLeGiamGia DECIMAL(5,2) DEFAULT 0,

    -- Processing time impact
    ThoiGianXuLyNhanh INT, -- Express processing time in hours
    ThoiGianXuLyThuong INT, -- Normal processing time in hours
    PhiPhatSinh DECIMAL(18,2) DEFAULT 0, -- Additional fees

    -- Payment configuration
    PhuongThucThanhToan NVARCHAR(MAX), -- JSON array of payment methods
    YeuCauThanhToanTruoc BIT DEFAULT 0,
    ChoPhepThanhToanPhan BIT DEFAULT 0,
    HanMucThanhToan DECIMAL(18,2),

    -- Refund policy
    ChinhSachHoanTra NVARCHAR(1000),
    TyLeHoanTra DECIMAL(5,2) DEFAULT 0,
    DieuKienHoanTra NVARCHAR(1000),
    ThoiHanHoanTra INT DEFAULT 30, -- Days

    -- Integration
    MaPhiTichHop NVARCHAR(100), -- Integration code
    APIThanhToan NVARCHAR(200), -- Payment API endpoint

    -- Validity period
    NgayHieuLuc DATE NOT NULL,
    NgayHetHieuLuc DATE,

    -- Approval and legal
    VanBanQuyDinh NVARCHAR(500), -- Legal document reference
    CoQuanBanHanh NVARCHAR(300),
    NgayBanHanh DATE,

    -- Status
    TrangThai TINYINT DEFAULT 1,

    -- Audit trail
    NgayTao DATETIME2 DEFAULT GETDATE(),
    NguoiTao BIGINT NOT NULL,
    NgayCapNhat DATETIME2,
    NguoiCapNhat BIGINT,

    CONSTRAINT FK_TTHC_PHI_TTHC FOREIGN KEY (TTHCID) REFERENCES [tthc].DM_QG_THUTUCHANHCHINH(TTHCID),
    CONSTRAINT CK_TTHC_PHI_GiaTri CHECK (GiaTriPhi >= 0),
    CONSTRAINT CK_TTHC_PHI_TyLeGiam CHECK (TyLeGiamGia BETWEEN 0 AND 100)
);
GO

-- Indexes
CREATE INDEX IX_TTHC_PHI_TTHC ON [tthc].DM_QG_TTHC_THOIGIAN_PHILEPHI(TTHCID, TrangThai);
CREATE INDEX IX_TTHC_PHI_LOAI ON [tthc].DM_QG_TTHC_THOIGIAN_PHILEPHI(LoaiPhi, NgayHieuLuc);
CREATE INDEX IX_TTHC_PHI_HIEU_LUC ON [tthc].DM_QG_TTHC_THOIGIAN_PHILEPHI(NgayHieuLuc, NgayHetHieuLuc);
CREATE INDEX IX_TTHC_PHI_GIA_TRI ON [tthc].DM_QG_TTHC_THOIGIAN_PHILEPHI(GiaTriPhi, LoaiPhi);
GO
```

### 6. DM_QG_TTHC_TRINHTUTHUCHIEN - Detailed execution procedures

```sql
CREATE TABLE [tthc].DM_QG_TTHC_TRINHTUTHUCHIEN (
    ID BIGINT PRIMARY KEY IDENTITY,
    TTHCID BIGINT NOT NULL,

    -- Step definition
    TenBuoc NVARCHAR(500) NOT NULL,
    MoTaBuoc NVARCHAR(2000),
    ThuTuBuoc INT NOT NULL,

    -- Step classification
    LoaiBuoc NVARCHAR(100), -- Submit/Review/Approve/Process/Deliver/Pay
    CapBuoc TINYINT, -- 1=Department, 2=Division, 3=Section, 4=Staff
    LaBuocBatBuoc BIT DEFAULT 1,
    LaBuocKyDienTu BIT DEFAULT 0,

    -- Processing details
    NguoiThucHien NVARCHAR(200), -- Role/Position responsible
    DonViThucHien NVARCHAR(300), -- Department/Unit responsible
    ThoiGianXuLy INT NOT NULL, -- Processing time in hours
    ThoiGianChoToiDa INT, -- Maximum wait time

    -- Business rules
    DieuKienTruocKhi NVARCHAR(2000), -- Prerequisites (JSON)
    DieuKienSauKhi NVARCHAR(2000), -- Post-conditions (JSON)
    QuyTacKiemTra NVARCHAR(2000), -- Validation rules (JSON)
    QuyTacTuDong NVARCHAR(2000), -- Automation rules (JSON)

    -- Document requirements
    TaiLieuCanThiet NVARCHAR(MAX), -- Required documents (JSON)
    TaiLieuSinhRa NVARCHAR(MAX), -- Generated documents (JSON)
    BieuMauSuDung NVARCHAR(500), -- Forms used

    -- Integration and automation
    CoTheXuLyTuDong BIT DEFAULT 0,
    MaAPITichHop NVARCHAR(100),
    ThamSoAPI NVARCHAR(1000), -- API parameters (JSON)
    DieuKienTuDong NVARCHAR(1000), -- Automation conditions

    -- Alternative paths
    BuocThayThe NVARCHAR(MAX), -- Alternative steps (JSON)
    DieuKienBocQua NVARCHAR(1000), -- Skip conditions
    BuocQuayLai NVARCHAR(100), -- Rollback step

    -- User interface
    GiaoDienHienThi NVARCHAR(500), -- UI component/template
    TruongNhapLieu NVARCHAR(MAX), -- Input fields (JSON)
    ThongBaoHienThi NVARCHAR(1000), -- Display messages
    HuongDanThucHien NVARCHAR(2000), -- Instructions

    -- Quality control
    YeuCauKiemDuyet BIT DEFAULT 0,
    SoNguoiKiemDuyet INT DEFAULT 1,
    TyLeLoiTrungBinh DECIMAL(5,2) DEFAULT 0,
    ThoiGianChinhSua INT DEFAULT 0, -- Time for corrections

    -- Notifications
    ThongBaoHoanThanh BIT DEFAULT 1,
    ThongBaoLoi BIT DEFAULT 1,
    NguoiNhanThongBao NVARCHAR(500), -- Recipients (JSON)
    MauThongBao NVARCHAR(500), -- Notification template

    -- Status and metrics
    TrangThai TINYINT DEFAULT 1,
    SoLanThucHienThang INT DEFAULT 0,
    TyLeThanhCong DECIMAL(5,2) DEFAULT 95.0,

    -- Audit trail
    NgayTao DATETIME2 DEFAULT GETDATE(),
    NguoiTao BIGINT NOT NULL,
    NgayCapNhat DATETIME2,
    NguoiCapNhat BIGINT,

    CONSTRAINT FK_TTHC_TRINH_TU_TTHC FOREIGN KEY (TTHCID) REFERENCES [tthc].DM_QG_THUTUCHANHCHINH(TTHCID),
    CONSTRAINT CK_TTHC_TRINH_TU_ThuTu CHECK (ThuTuBuoc > 0),
    CONSTRAINT CK_TTHC_TRINH_TU_ThoiGian CHECK (ThoiGianXuLy > 0)
);
GO

-- Indexes
CREATE INDEX IX_TTHC_TRINH_TU_TTHC ON [tthc].DM_QG_TTHC_TRINHTUTHUCHIEN(TTHCID, ThuTuBuoc);
CREATE INDEX IX_TTHC_TRINH_TU_LOAI ON [tthc].DM_QG_TTHC_TRINHTUTHUCHIEN(LoaiBuoc, TrangThai);
CREATE INDEX IX_TTHC_TRINH_TU_BAT_BUOC ON [tthc].DM_QG_TTHC_TRINHTUTHUCHIEN(LaBuocBatBuoc, CapBuoc);
CREATE INDEX IX_TTHC_TRINH_TU_TU_DONG ON [tthc].DM_QG_TTHC_TRINHTUTHUCHIEN(CoTheXuLyTuDong, TrangThai);
GO
```

## RELATIONSHIP TABLES

### 7. DM_QG_TTHC_LINHVUC - Procedure-field relationships

```sql
CREATE TABLE [tthc].DM_QG_TTHC_LINHVUC (
    ID BIGINT PRIMARY KEY IDENTITY,
    TTHCID BIGINT NOT NULL,
    LinhVucID INT NOT NULL,
    LinhVucCon NVARCHAR(200), -- Sub-field specification
    MucDoLienQuan TINYINT DEFAULT 3, -- 1=High, 2=Medium, 3=Low
    MoTaLienQuan NVARCHAR(1000),

    NgayTao DATETIME2 DEFAULT GETDATE(),
    NguoiTao BIGINT NOT NULL,

    CONSTRAINT FK_TTHC_LV_TTHC FOREIGN KEY (TTHCID) REFERENCES [tthc].DM_QG_THUTUCHANHCHINH(TTHCID),
    CONSTRAINT FK_TTHC_LV_LINHVUC FOREIGN KEY (LinhVucID) REFERENCES [lookup].DM_QG_LINHVUC(LinhVucID),
    CONSTRAINT UC_TTHC_LINHVUC UNIQUE (TTHCID, LinhVucID)
);
GO

CREATE INDEX IX_TTHC_LV_TTHC ON [tthc].DM_QG_TTHC_LINHVUC(TTHCID);
CREATE INDEX IX_TTHC_LV_LINHVUC ON [tthc].DM_QG_TTHC_LINHVUC(LinhVucID, MucDoLienQuan);
GO
```

### 8. DM_QG_TTHC_DOITUONG - Target audience definitions

```sql
CREATE TABLE [tthc].DM_QG_TTHC_DOITUONG (
    ID BIGINT PRIMARY KEY IDENTITY,
    TTHCID BIGINT NOT NULL,
    DoiTuongID INT NOT NULL,

    -- Target specification
    MoTaChiTiet NVARCHAR(1000),
    DieuKienApDung NVARCHAR(2000), -- JSON conditions
    YeuCauDacBiet NVARCHAR(1000),

    -- Processing differences
    ThoiGianXuLyKhacBiet INT, -- Different processing time
    PhiLe DECIMAL(18,2), -- Special fee
    TaiLieuBoDung NVARCHAR(MAX), -- Additional documents (JSON)

    -- Priority and handling
    MucDoUuTien TINYINT DEFAULT 3, -- 1=High, 2=Medium, 3=Normal
    YeuCauXuLyDacBiet BIT DEFAULT 0,
    CanBoChuyenTach BIT DEFAULT 0, -- Need specialized staff

    NgayTao DATETIME2 DEFAULT GETDATE(),
    NguoiTao BIGINT NOT NULL,

    CONSTRAINT FK_TTHC_DT_TTHC FOREIGN KEY (TTHCID) REFERENCES [tthc].DM_QG_THUTUCHANHCHINH(TTHCID),
    CONSTRAINT FK_TTHC_DT_DOITUONG FOREIGN KEY (DoiTuongID) REFERENCES [lookup].DM_DOITUONGTHUCHIEN(DoiTuongID),
    CONSTRAINT UC_TTHC_DOITUONG UNIQUE (TTHCID, DoiTuongID)
);
GO

CREATE INDEX IX_TTHC_DT_TTHC ON [tthc].DM_QG_TTHC_DOITUONG(TTHCID);
CREATE INDEX IX_TTHC_DT_DOITUONG ON [tthc].DM_QG_TTHC_DOITUONG(DoiTuongID, MucDoUuTien);
GO
```

## SUPPORTING TABLES

### 9. TTHC_INTEGRATION_LOG - Integration and API call logs

```sql
CREATE TABLE [tthc].TTHC_INTEGRATION_LOG (
    LogID BIGINT PRIMARY KEY IDENTITY,
    TTHCID BIGINT NOT NULL,

    -- Integration details
    IntegrationType NVARCHAR(100) NOT NULL, -- API/Database/File/Manual
    ExternalSystem NVARCHAR(200) NOT NULL,
    OperationType NVARCHAR(100) NOT NULL, -- Sync/Validate/Update/Query

    -- Request details
    RequestData NVARCHAR(MAX), -- JSON request
    RequestHeaders NVARCHAR(2000), -- HTTP headers
    RequestTimestamp DATETIME2 DEFAULT GETDATE(),

    -- Response details
    ResponseData NVARCHAR(MAX), -- JSON response
    ResponseCode NVARCHAR(20),
    ResponseMessage NVARCHAR(1000),
    ResponseTimestamp DATETIME2,

    -- Performance metrics
    ResponseTimeMs INT,
    DataSizeBytes INT,
    RetryCount INT DEFAULT 0,

    -- Status tracking
    Status NVARCHAR(50) NOT NULL, -- Success/Error/Timeout/Retry
    ErrorCode NVARCHAR(100),
    ErrorDetails NVARCHAR(2000),

    -- Context
    UserID BIGINT,
    SessionID NVARCHAR(128),
    ProcessID NVARCHAR(100),

    CONSTRAINT FK_TTHC_INTEGRATION_TTHC FOREIGN KEY (TTHCID) REFERENCES [tthc].DM_QG_THUTUCHANHCHINH(TTHCID)
);
GO

-- Indexes
CREATE INDEX IX_TTHC_INTEGRATION_TTHC ON [tthc].TTHC_INTEGRATION_LOG(TTHCID, RequestTimestamp DESC);
CREATE INDEX IX_TTHC_INTEGRATION_TYPE ON [tthc].TTHC_INTEGRATION_LOG(IntegrationType, ExternalSystem);
CREATE INDEX IX_TTHC_INTEGRATION_STATUS ON [tthc].TTHC_INTEGRATION_LOG(Status, RequestTimestamp DESC);
CREATE INDEX IX_TTHC_INTEGRATION_PERFORMANCE ON [tthc].TTHC_INTEGRATION_LOG(ResponseTimeMs DESC, RequestTimestamp DESC);
GO
```

### 10. TTHC_BUSINESS_RULES - Normalized business rules

```sql
CREATE TABLE [tthc].TTHC_BUSINESS_RULES (
    RuleID BIGINT PRIMARY KEY IDENTITY,
    TTHCID BIGINT NOT NULL,
    RuleCategory NVARCHAR(100) NOT NULL, -- Validation/Assignment/Processing/Approval

    -- Rule definition
    RuleName NVARCHAR(300) NOT NULL,
    RuleDescription NVARCHAR(1000),
    RuleExpression NVARCHAR(4000) NOT NULL, -- Business rule expression

    -- Rule context
    AppliesTo NVARCHAR(200), -- What this rule applies to
    ExecutionOrder INT DEFAULT 1,
    IsActive BIT DEFAULT 1,

    -- Conditions
    Conditions NVARCHAR(MAX), -- JSON conditions
    Actions NVARCHAR(MAX), -- JSON actions to take
    ErrorMessage NVARCHAR(500), -- Error message if rule fails

    -- Metadata
    RuleVersion NVARCHAR(20) DEFAULT '1.0',
    EffectiveFrom DATE DEFAULT GETDATE(),
    EffectiveTo DATE,

    -- Audit trail
    NgayTao DATETIME2 DEFAULT GETDATE(),
    NguoiTao BIGINT NOT NULL,
    NgayCapNhat DATETIME2,
    NguoiCapNhat BIGINT,

    CONSTRAINT FK_TTHC_RULES_TTHC FOREIGN KEY (TTHCID) REFERENCES [tthc].DM_QG_THUTUCHANHCHINH(TTHCID)
);
GO

-- Indexes
CREATE INDEX IX_TTHC_RULES_TTHC ON [tthc].TTHC_BUSINESS_RULES(TTHCID, IsActive);
CREATE INDEX IX_TTHC_RULES_CATEGORY ON [tthc].TTHC_BUSINESS_RULES(RuleCategory, ExecutionOrder);
CREATE INDEX IX_TTHC_RULES_EFFECTIVE ON [tthc].TTHC_BUSINESS_RULES(EffectiveFrom, EffectiveTo);
GO
```

## CROSS-SCHEMA INTEGRATION VIEWS

```sql
-- View for Case service to access procedure information
CREATE VIEW [case].v_TTHCInfo
AS
SELECT
    t.TTHCID,
    t.MaTTHC,
    t.TenTTHC,
    t.LinhVucID,
    t.CapThucHienID,
    t.ThoiHanGiaiQuyetNgay,
    t.ThoiHanGiaiQuyetGio,
    t.MucDoDienTuHoa,
    t.HoTroDienTu,
    t.YeuCauChuKySo,
    t.TrangThaiSuDung
FROM [tthc].DM_QG_THUTUCHANHCHINH t
WHERE t.IsActive = 1 AND t.TrangThaiSuDung = 1;
GO

-- View for Workflow service to access procedure steps
CREATE VIEW [workflow].v_TTHCSteps
AS
SELECT
    tt.TTHCID,
    tt.MaTTHC,
    s.ID as StepID,
    s.TenBuoc,
    s.ThuTuBuoc,
    s.LoaiBuoc,
    s.ThoiGianXuLy,
    s.CoTheXuLyTuDong,
    s.QuyTacTuDong
FROM [tthc].DM_QG_THUTUCHANHCHINH tt
INNER JOIN [tthc].DM_QG_TTHC_TRINHTUTHUCHIEN s ON tt.TTHCID = s.TTHCID
WHERE tt.IsActive = 1 AND s.TrangThai = 1;
GO

-- View for Payment service to access fee information
CREATE VIEW [payment].v_TTHCFees
AS
SELECT
    t.TTHCID,
    t.MaTTHC,
    f.ID as FeeID,
    f.TenKhoanPhi,
    f.LoaiPhi,
    f.GiaTriPhi,
    f.DonViTinh,
    f.PhuongThucThanhToan,
    f.NgayHieuLuc,
    f.NgayHetHieuLuc
FROM [tthc].DM_QG_THUTUCHANHCHINH t
INNER JOIN [tthc].DM_QG_TTHC_THOIGIAN_PHILEPHI f ON t.TTHCID = f.TTHCID
WHERE t.IsActive = 1 AND f.TrangThai = 1;
GO
```

## KEY FEATURES

### Comprehensive Procedure Catalog
- **Complete Procedure Definitions**: All aspects of administrative procedures including legal framework, requirements, steps, and outcomes
- **Hierarchical Organization**: Support for central, provincial, district, and commune level procedures
- **Digital Transformation Tracking**: Measure and manage digitization progress
- **Quality Metrics**: Track performance, satisfaction, and compliance metrics

### Flexible Business Rules Engine
- **Normalized Business Rules**: Structured business rules for validation, assignment, and processing
- **Conditional Logic**: Complex conditional rules with JSON-based expressions
- **Rule Versioning**: Support for rule evolution and change management
- **Dynamic Rule Execution**: Runtime rule evaluation and application

### Fee Management System
- **Complex Fee Structures**: Support for fixed, variable, calculated, and tiered fees
- **Time-based Pricing**: Different fees for express vs normal processing
- **Payment Integration**: Multiple payment methods and refund policies
- **Legal Compliance**: Fee structure based on official regulations

### Document Requirements Management
- **Detailed Document Specifications**: Complete requirements for supporting documents
- **Validation Rules**: Automated document validation and verification
- **Alternative Documents**: Support for substitute documents and exemptions
- **Digital Integration**: OCR support and national database integration

### Implementation Organization Management
- **Multi-organization Support**: Track which organizations can implement procedures
- **Capacity Management**: Monitor processing capacity and performance
- **Service Configuration**: Flexible service delivery options
- **Quality Tracking**: Performance metrics and customer satisfaction

## BUSINESS RULES

### Procedure Lifecycle Management
- Procedures must have valid effective dates
- Legal framework references are required for all procedures
- Digital transformation level must progress sequentially
- Fee structures must align with legal regulations

### Organization Implementation Rules
- Organizations must have appropriate capacity for assigned procedures
- Primary implementer must be designated for each procedure
- Service delivery methods must match organizational capabilities
- Quality metrics must meet minimum thresholds

### Document Requirements Validation
- Required documents must be clearly specified
- Alternative documents must have equivalent validation value
- Document validity periods must be enforced
- OCR and automated processing capabilities must be tested

### Fee Structure Compliance
- Fee calculations must be based on official regulations
- Discount periods and conditions must be clearly defined
- Payment methods must be supported by the organization
- Refund policies must comply with government regulations

## PERFORMANCE CONSIDERATIONS

### Indexing Strategy
- Composite indexes for common query patterns (procedure lookup, organization search)
- JSON field indexing for business rules and conditions
- Time-based indexes for effective date queries
- Full-text indexes for search functionality

### Caching Strategy
- Procedure catalog cached with smart invalidation
- Business rules cached per procedure with version tracking
- Fee calculations cached with time-based expiration
- Organization capabilities cached with real-time updates

### Query Optimization
- Materialized views for cross-schema access
- Denormalized commonly accessed data
- Optimized joins with lookup tables
- Bulk operations for data synchronization

## INTEGRATION PATTERNS

### Event-Driven Architecture
```sql
-- Events published by TTHC service:
-- ProcedureCreated
-- ProcedureUpdated
-- ProcedureActivated
-- ProcedureDeactivated
-- BusinessRuleChanged
-- FeeStructureUpdated
-- DocumentRequirementChanged
-- ImplementationOrganizationChanged
```

### API Integration Points
- External legal framework validation
- National database integration for procedure verification
- Payment gateway integration for fee processing
- Workflow engine integration for process automation
- Document management system integration

### Cross-Service Communication
- Case service subscribes to procedure updates
- Workflow service consumes procedure step definitions
- Payment service uses fee structure information
- Audit service logs all procedure-related changes

## MIGRATION CONSIDERATIONS

### From Legacy Systems
- Data mapping from existing procedure catalogs
- Business rule extraction and normalization
- Fee structure consolidation and validation
- Document requirement standardization

### To Microservices Architecture
- TTHC service extraction with complete procedure management
- Event-driven updates to dependent services
- API design for procedure catalog access
- Eventual consistency for distributed procedure data

### Data Archiving Strategy
- Historical procedure versions preservation
- Inactive procedure data retention
- Audit trail for procedure changes
- Compliance with government retention policies