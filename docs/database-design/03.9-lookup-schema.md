# [lookup] Schema - Master Data and Lookup Tables

## OVERVIEW

The `[lookup]` schema contains all shared master data and lookup tables used across the DVC v2 system. This schema serves as a cross-cutting concern that can be accessed by all other schemas in read-only mode.

## SCHEMA CREATION

```sql
-- Shared/Common schemas
CREATE SCHEMA [lookup];   -- Master data tables
GO
```

## CORE STATUS AND CATEGORY TABLES

### 1. DM_QG_TINHTRANG - State/Status master data

```sql
CREATE TABLE [lookup].DM_QG_TINHTRANG (
    TinhTrangID INT PRIMARY KEY IDENTITY,
    MaTinhTrang NVARCHAR(20) UNIQUE NOT NULL,
    TenTinhTrang NVARCHAR(100) NOT NULL,
    MauSac NVARCHAR(7), -- Hex color for UI
    Icon NVARCHAR(50), -- Icon class for UI
    ThuTu INT DEFAULT 0,
    IsActive BIT DEFAULT 1,
    CreatedAt DATETIME2 DEFAULT GETDATE(),
    CreatedBy BIGINT,
    UpdatedAt DATETIME2,
    UpdatedBy BIGINT
);
GO

CREATE INDEX IX_DM_QG_TINHTRANG_MaTinhTrang ON [lookup].DM_QG_TINHTRANG(MaTinhTrang);
GO
```

### 2. DM_QG_GIOITINH - Gender lookup

```sql
CREATE TABLE [lookup].DM_QG_GIOITINH (
    GioiTinhID BIGINT PRIMARY KEY IDENTITY,
    MaGioiTinh NVARCHAR(10) UNIQUE NOT NULL,
    TenGioiTinh NVARCHAR(20) NOT NULL,
    IsActive BIT DEFAULT 1
);
GO
```

### 3. DM_QG_LINHVUC - Fields/Sectors lookup

```sql
CREATE TABLE [lookup].DM_QG_LINHVUC (
    LinhVucID INT PRIMARY KEY IDENTITY,
    MaLinhVuc NVARCHAR(50) UNIQUE NOT NULL,
    TenLinhVuc NVARCHAR(255) NOT NULL,
    MaNganh NVARCHAR(50),
    TenNganh NVARCHAR(255),
    MoTa NVARCHAR(2000),
    Icon NVARCHAR(50),
    ThuTu INT DEFAULT 0,
    IsActive BIT DEFAULT 1,
    CreatedAt DATETIME2 DEFAULT GETDATE(),
    CreatedBy BIGINT,
    UpdatedAt DATETIME2,
    UpdatedBy BIGINT
);
GO

CREATE INDEX IX_DM_QG_LINHVUC_MaLinhVuc ON [lookup].DM_QG_LINHVUC(MaLinhVuc);
GO
```

### 4. DM_CAPTHUCHIEN - Administrative levels

```sql
CREATE TABLE [lookup].DM_CAPTHUCHIEN (
    CapThucHienID BIGINT PRIMARY KEY IDENTITY,
    MaCap NVARCHAR(10) UNIQUE NOT NULL,
    TenCap NVARCHAR(100) NOT NULL,
    MoTa NVARCHAR(500),
    Level INT NOT NULL, -- 1=TW, 2=Tỉnh, 3=Huyện, 4=Xã
    ThuTu INT DEFAULT 0,
    IsActive BIT DEFAULT 1,
    CreatedAt DATETIME2 DEFAULT GETDATE()
);
GO

CREATE INDEX IX_DM_CAPTHUCHIEN_Level ON [lookup].DM_CAPTHUCHIEN(Level);
GO
```

### 5. DM_KENH - Service channels

```sql
CREATE TABLE [lookup].DM_KENH (
    KenhID BIGINT PRIMARY KEY IDENTITY,
    MaKenh NVARCHAR(10) UNIQUE NOT NULL,
    TenKenh NVARCHAR(100) NOT NULL,
    MoTa NVARCHAR(500),
    IsOnline BIT DEFAULT 0,
    RequireAuth BIT DEFAULT 1,
    SupportPayment BIT DEFAULT 1,
    Icon NVARCHAR(50),
    ThuTu INT DEFAULT 0,
    IsActive BIT DEFAULT 1,
    CreatedAt DATETIME2 DEFAULT GETDATE()
);
GO

CREATE INDEX IX_DM_KENH_MaKenh ON [lookup].DM_KENH(MaKenh);
GO
```

### 6. DM_HINHTHUCTHANHTOAN - Payment methods

```sql
CREATE TABLE [lookup].DM_HINHTHUCTHANHTOAN (
    HinhThucThanhToanID INT PRIMARY KEY IDENTITY,
    MaHinhThucThanhToan NVARCHAR(20) UNIQUE NOT NULL,
    TenHinhThucThanhToan NVARCHAR(100) NOT NULL,
    MoTa NVARCHAR(500),
    IsOnlineSupported BIT DEFAULT 0,
    RequireBank BIT DEFAULT 0,
    ProcessingFeePercent DECIMAL(5,2) DEFAULT 0,
    MinAmount DECIMAL(18,2) DEFAULT 0,
    MaxAmount DECIMAL(18,2),
    Icon NVARCHAR(50),
    ThuTu INT DEFAULT 0,
    IsActive BIT DEFAULT 1,
    CreatedAt DATETIME2 DEFAULT GETDATE(),
    CreatedBy BIGINT,
    UpdatedAt DATETIME2,
    UpdatedBy BIGINT
);
GO
```

### 7. DM_NGUONHOSO - Application sources

```sql
CREATE TABLE [lookup].DM_NGUONHOSO (
    NguonHoSoID INT PRIMARY KEY IDENTITY,
    MaNguon NVARCHAR(20) UNIQUE NOT NULL,
    TenNguon NVARCHAR(100) NOT NULL,
    MoTa NVARCHAR(500),
    IsSystemGenerated BIT DEFAULT 0,
    RequireAuth BIT DEFAULT 1,
    DefaultKenhID BIGINT,
    ThuTu INT DEFAULT 0,
    IsActive BIT DEFAULT 1,
    CreatedAt DATETIME2 DEFAULT GETDATE(),
    FOREIGN KEY (DefaultKenhID) REFERENCES [lookup].DM_KENH(KenhID)
);
GO
```

## GEOGRAPHICAL AND ADMINISTRATIVE DATA

### 8. DM_TCTK_DONVIHANHCHINH - Administrative divisions

```sql
CREATE TABLE [lookup].DM_TCTK_DONVIHANHCHINH (
    ID INT PRIMARY KEY IDENTITY,
    IdDanhMuc NVARCHAR(20) UNIQUE,
    MaDonViHanhChinh NVARCHAR(20) UNIQUE NOT NULL,
    TenDonViHanhChinh NVARCHAR(255) NOT NULL,
    TenDayDuDonViHanhChinh NVARCHAR(500),
    MaLoaiDonViHanhChinh NVARCHAR(20),
    TenLoaiDonViHanhChinh NVARCHAR(100),
    MaDonViHanhChinhCha NVARCHAR(20),
    DonViHanhChinhChaID INT,
    MaTinhThanh NVARCHAR(20),
    TenTinhThanh NVARCHAR(255),
    Level TINYINT, -- 1=Quốc gia, 2=Tỉnh, 3=Huyện, 4=Xã
    HierarchyPath NVARCHAR(500), -- /1/2/3/4 for fast hierarchy queries
    TrangThaiHieuLuc NVARCHAR(20),
    TrangThaiDuLieu NVARCHAR(20),
    NgayHieuLuc DATE,
    NgayHetHieuLuc DATE,
    CreatedAt DATETIME2 DEFAULT GETDATE(),
    UpdatedAt DATETIME2,
    IsActive BIT DEFAULT 1,
    FOREIGN KEY (DonViHanhChinhChaID) REFERENCES [lookup].DM_TCTK_DONVIHANHCHINH(ID)
);
GO

CREATE INDEX IX_TCTK_DVHC_Ma ON [lookup].DM_TCTK_DONVIHANHCHINH(MaDonViHanhChinh);
CREATE INDEX IX_TCTK_DVHC_Hierarchy ON [lookup].DM_TCTK_DONVIHANHCHINH(HierarchyPath);
CREATE INDEX IX_TCTK_DVHC_Level ON [lookup].DM_TCTK_DONVIHANHCHINH(Level);
CREATE INDEX IX_TCTK_DVHC_Parent ON [lookup].DM_TCTK_DONVIHANHCHINH(DonViHanhChinhChaID);
GO
```

### 9. DM_TCTK_DANTOC - Ethnicity lookup

```sql
CREATE TABLE [lookup].DM_TCTK_DANTOC (
    DanTocID INT PRIMARY KEY IDENTITY,
    MaDanToc NVARCHAR(20) UNIQUE NOT NULL,
    TenDanToc NVARCHAR(100) NOT NULL,
    TenTiengAnh NVARCHAR(100),
    ThuTu INT DEFAULT 0,
    IsActive BIT DEFAULT 1,
    CreatedAt DATETIME2 DEFAULT GETDATE()
);
GO

CREATE INDEX IX_TCTK_DANTOC_Ma ON [lookup].DM_TCTK_DANTOC(MaDanToc);
GO
```

### 10. DM_TCTK_QUOCTICH - Nationality lookup

```sql
CREATE TABLE [lookup].DM_TCTK_QUOCTICH (
    QuocTichID INT PRIMARY KEY IDENTITY,
    MaQuocTich NVARCHAR(20) UNIQUE NOT NULL,
    TenQuocTich NVARCHAR(100) NOT NULL,
    TenTiengAnh NVARCHAR(100),
    MaISO2 CHAR(2), -- ISO 3166-1 alpha-2
    MaISO3 CHAR(3), -- ISO 3166-1 alpha-3
    ThuTu INT DEFAULT 0,
    IsActive BIT DEFAULT 1,
    CreatedAt DATETIME2 DEFAULT GETDATE()
);
GO

CREATE INDEX IX_TCTK_QUOCTICH_Ma ON [lookup].DM_TCTK_QUOCTICH(MaQuocTich);
CREATE INDEX IX_TCTK_QUOCTICH_ISO ON [lookup].DM_TCTK_QUOCTICH(MaISO2, MaISO3);
GO
```

## KEY FEATURES

### Cross-Schema Access Pattern
- **Read-Only Access**: All other schemas can read from lookup tables
- **Exception to FK Rules**: Foreign keys to lookup schema are allowed across schemas
- **Master Data Governance**: Centralized control of reference data
- **Data Consistency**: Ensures consistent values across all services

### Multi-Language Support
- Vietnamese primary names with English translations where applicable
- ISO standard codes for international compatibility
- Cultural context preserved in Vietnamese administrative terms

### Hierarchical Data Support
- Administrative divisions with full hierarchy paths
- Fast hierarchy queries using path-based indexing
- Support for organizational structures at all levels

### UI Integration Support
- Color coding for status visualization
- Icon classes for modern UI frameworks
- Display order configuration (ThuTu)
- Active/inactive status management

### Performance Optimization
- Comprehensive indexing strategy
- Optimized for read-heavy workloads
- Efficient hierarchy traversal
- Minimal storage footprint

## SAMPLE DATA CATEGORIES

### Status Types (DM_QG_TINHTRANG)
- Application statuses: Received, Processing, Approved, Rejected, Completed
- Document statuses: Draft, Submitted, Validated, Signed
- Payment statuses: Pending, Paid, Failed, Refunded
- System statuses: Active, Inactive, Maintenance, Error

### Service Channels (DM_KENH)
- Online portal (Cổng dịch vụ công)
- Mobile application
- In-person service centers
- Postal service
- Third-party integration

### Payment Methods (DM_HINHTHUCTHANHTOAN)
- Cash payment
- Bank transfer
- Online banking
- E-wallets (MoMo, ZaloPay, ViettelPay)
- Credit/debit cards
- Cryptocurrency (future)

### Administrative Levels (DM_CAPTHUCHIEN)
- Central level (Trung ương)
- Provincial level (Tỉnh/Thành phố)
- District level (Quận/Huyện)
- Commune level (Phường/Xã)

## MAINTENANCE PROCEDURES

### Data Updates
- Master data changes require approval workflow
- Version control for critical reference data
- Audit trail for all changes
- Bulk update procedures for system migrations

### Cache Management
- Application-level caching recommended
- Cache invalidation on updates
- Redis integration for distributed caching
- TTL configuration based on data volatility

### Data Quality
- Regular data validation procedures
- Duplicate detection and cleanup
- Foreign key integrity checks
- Reference data completeness validation

## MICROSERVICES CONSIDERATIONS

### Service Boundaries
- Lookup data is cross-cutting concern
- Can be extracted as separate Lookup microservice
- API-based access for future microservices architecture
- Event-driven updates for cache synchronization

### Migration Strategy
- Phase 1: Shared database schema (current)
- Phase 2: Lookup service with API
- Phase 3: Event-driven synchronization
- Phase 4: Full microservices architecture

### API Design
- RESTful endpoints for each lookup table
- GraphQL support for complex queries
- Caching headers for client-side optimization
- Versioning strategy for backward compatibility